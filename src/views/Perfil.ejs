<!DOCTYPE html>
<html lang="pt-br">

<head>
  <%- include('partials/head') %>

  <title>Perfil - Portal de Oportunidades</title>
  
  <link rel="stylesheet" href="/CSS/perfil.css">
</head>

<body data-show-welcome-toast="<%= locals.showWelcomeToast ? 'true' : 'false' %>"
      data-user-name="<%= locals.user?.nome || '' %>">

  <%- include('partials/navbar') %>

  <main class="container my-5">
    
    <% if (locals.curriculo) { %>

      <h2 class="text-center mb-4">Meu Perfil</h2>

      <section class="text-center mb-4" aria-label="Identificação do Usuário">
        <img src="./Images/usuario.png" class="profile-pic mb-3" alt="Foto de perfil">
        
        <h4><%= curriculo.nome %></h4>
        <p class="text-muted fw-bold">
            <%= labelsStatusProfissional[curriculo.status] || curriculo.status %>
        </p>
      </section>

      <section class="mb-4" aria-labelledby="info-pessoais-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="info-pessoais-heading">Informações Pessoais</h5>
            <p><strong>Email:</strong> <%= curriculo.email %></p>
            <p><strong>CPF:</strong> <%= curriculo.cpf %></p>
            <p><strong>Telefone:</strong> <%= curriculo.telefone %></p>
            <p><strong>Cidade:</strong> <%= curriculo.cidade %></p>
           <% if (curriculo.linkedin) { %>
                <p>
                    <strong>LinkedIn:</strong> 
                    <a href="<%= curriculo.linkedin %>" target="_blank">
                        <%= curriculo.linkedin %>
                    </a>
                </p>
            <% } %>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="resumo-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="resumo-heading">Resumo Profissional</h5>
            <p><%= curriculo.resumo || "Não informado." %></p>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="formacao-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="formacao-heading">Formação Acadêmica</h5>
            <% if (curriculo.curso) { %>
                <p>
                    <strong><%= curriculo.curso %></strong> <br>
                    <%= curriculo.faculdade %> <br>
                    <span class="text-muted small">
                        Status: <%= labelsStatus[curriculo.statusCurso] || curriculo.statusCurso %>
                    </span>
                </p>
            <% } else { %>
                <p class="text-muted mb-0">Nenhuma formação acadêmica cadastrada.</p>
            <% } %>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="experiencia-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="experiencia-heading">Experiência Profissional</h5>
            <% if (curriculo.cargo) { %>
                <p>
                    <strong><%= curriculo.cargo %></strong> <br>
                    <%= curriculo.empresa %> <br>
                    <span class="text-muted small">
                        Tempo: <%= labelsTempo[curriculo.tempoExperiencia] || curriculo.tempoExperiencia %>
                    </span>
                </p>
            <% } else { %>
                <p class="text-muted mb-0">Nenhuma experiência profissional cadastrada.</p>
            <% } %>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="habilidades-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="habilidades-heading">Competências e Habilidades</h5>
            
            <% if (curriculo.habilidades) { %>
                <% try { %>
                  <% const skills = JSON.parse(curriculo.habilidades); %>
                  <% if (skills.length > 0) { %>
                    <% skills.forEach(function(skill) { %>
                      <span class="badge bg-primary me-1 mb-1 p-2"><%= skill %></span>
                    <% }); %>
                  <% } else { %>
                    <span class="text-muted">Nenhuma habilidade cadastrada.</span>
                  <% } %>
                <% } catch (e) { %>
                  <span class="text-muted"><%= curriculo.habilidades %></span>
                <% } %>
            <% } %>

          </div>
        </div>
      </section>

      <section class="text-center" aria-label="Ações da Conta">
        <a href="/curriculo" class="btn btn-primary">
          <i class="las la-edit"></i> Editar Currículo
        </a>
        <a href="/logout" class="btn btn-danger">Sair</a>
      </section>

    <% } else { %>
      
      <div class="text-center py-5">
        <% if (locals.user) { %>
            <h2 class="mb-3">Olá, <%= user.nome %>!</h2>
        <% } %>
        <h4 class="text-muted mb-4">Você ainda não preencheu seu currículo.</h4>
        <p class="mb-5">Para aparecer para as empresas e ver seu perfil completo, preencha seus dados agora.</p>
        
        <a href="/curriculo" class="btn btn-success btn-lg">
            <i class="las la-plus-circle me-2"></i>Criar Meu Currículo
        </a>
        <br><br>
        <a href="/logout" class="btn btn-outline-danger mt-3">Sair</a>
      </div>

    <% } %>

  </main>

  <%- include('partials/footer') %>

  <script src="/JS/feedback.js" defer></script>
</body>

</html>