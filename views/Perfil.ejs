<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Visualize e gerencie seu perfil profissional no Portal de Oportunidades. Mantenha suas informações pessoais, resumo e experiências sempre atualizadas.">
  <title>Perfil - Portal de Oportunidades</title>
  
  <link rel="stylesheet" href="/CSS/perfil.css">
  <link rel="stylesheet" href="/CSS/footer.css">
  <link rel="stylesheet" href="/CSS/menu.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css">
</head>

<body>
  <nav class="navbar navbar-dark bg-custom-blue">
    <div class="container-fluid">
      <a class="navbar-brand" href="/home">Portal de Oportunidades</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menu">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="menu">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="/home">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="/perfil">Perfil</a></li>
          <li class="nav-item"><a class="nav-link" href="/curriculo">Currículo</a></li>
          <li class="nav-item"><a class="nav-link" href="/">Login</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">
    
    <% if (locals.curriculo) { %>

      <h2 class="text-center mb-4">Meu Perfil</h2>

      <section class="text-center mb-4" aria-label="Identificação do Usuário">
        <img src="./Images/fotodeperfil.jpg" class="profile-pic mb-3" alt="Foto de perfil">
        
        <h4><%= curriculo.nome %></h4>
        <p class="text-muted fw-bold">
            <%= labelsStatusProfissional[curriculo.status] || curriculo.status %>
        </p>
      </section>

      <section class="mb-4" aria-labelledby="info-pessoais-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="info-pessoais-heading">Informações Pessoais</h5>
            <p><strong>Email:</strong> <%= curriculo.email %></p>
            <p><strong>CPF:</strong> <%= curriculo.cpf %></p>
            <p><strong>Telefone:</strong> <%= curriculo.telefone %></p>
            <p><strong>Cidade:</strong> <%= curriculo.cidade %></p>
            <% if (curriculo.linkedin) { %>
                <p><strong>LinkedIn:</strong> <a href="<%= curriculo.linkedin %>" target="_blank">Acessar Perfil</a></p>
            <% } %>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="resumo-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="resumo-heading">Resumo Profissional</h5>
            <p><%= curriculo.resumo || "Não informado." %></p>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="formacao-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="formacao-heading">Formação Acadêmica</h5>
            <p>
                <strong><%= curriculo.curso %></strong> <br>
                <%= curriculo.faculdade %> <br>
                <span class="text-muted small">Status: <%= labelsStatus[curriculo.statusCurso] || curriculo.statusCurso %></span>
            </p>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="experiencia-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="experiencia-heading">Experiência Profissional</h5>
            <p>
                <strong><%= curriculo.cargo %></strong> <br>
                <%= curriculo.empresa %> <br>
                <span class="text-muted small">Tempo: <%= labelsTempo[curriculo.tempoExperiencia] || curriculo.tempoExperiencia %></span>
            </p>
          </div>
        </div>
      </section>

      <section class="mb-4" aria-labelledby="habilidades-heading">
        <div class="card shadow">
          <div class="card-body">
            <h5 class="card-title" id="habilidades-heading">Competências e Habilidades</h5>
            
            <% if (curriculo.habilidades) { %>
                <% try { %>
                  <% const skills = JSON.parse(curriculo.habilidades); %>
                  <% if (skills.length > 0) { %>
                    <% skills.forEach(function(skill) { %>
                      <span class="badge bg-primary me-1 mb-1 p-2"><%= skill %></span>
                    <% }); %>
                  <% } else { %>
                    <span class="text-muted">Nenhuma habilidade cadastrada.</span>
                  <% } %>
                <% } catch (e) { %>
                  <span class="text-muted"><%= curriculo.habilidades %></span>
                <% } %>
            <% } %>

          </div>
        </div>
      </section>

      <section class="text-center" aria-label="Ações da Conta">
        <a href="/curriculo" class="btn btn-primary">
          <i class="las la-edit"></i> Editar Currículo
        </a>
        <a href="/logout" class="btn btn-danger">Sair</a>
      </section>

    <% } else { %>
      
      <div class="text-center py-5">
        <% if (locals.user) { %>
            <h2 class="mb-3">Olá, <%= user.nome %>!</h2>
        <% } %>
        <h4 class="text-muted mb-4">Você ainda não preencheu seu currículo.</h4>
        <p class="mb-5">Para aparecer para as empresas e ver seu perfil completo, preencha seus dados agora.</p>
        
        <a href="/curriculo" class="btn btn-success btn-lg">
            <i class="las la-plus-circle me-2"></i>Criar Meu Currículo
        </a>
        <br><br>
        <a href="/logout" class="btn btn-outline-danger mt-3">Sair</a>
      </div>

    <% } %>

  </main>

  <div id="toast-container" class="toast-container position-fixed top-0 end-0 p-3">
    <div id="toast-template" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto toast-title"></strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body"></div>
    </div>
  </div>

  <footer>
    <div class="content">
      <p>Transformando carreiras, uma vaga de cada vez. Nosso compromisso é oferecer um serviço gratuito e de qualidade,
        ajudando empresas a encontrar os melhores talentos e profissionais a alcançarem seu potencial.</p>
      <ul class="sm">
        <li><a href="#"><i class="lab la-youtube"></i></a></li>
        <li><a href="#"><i class="lab la-facebook"></i></a></li>
        <li><a href="#"><i class="lab la-instagram"></i></a></li>
        <li><a href="#"><i class="lab la-twitter"></i></a></li>
        <li><a href="#"><i class="lab la-github"></i></a></li>
      </ul>
      <ul class="links">
        <li><a href="#">Home</a></li>
        <li><a href="#">About</a></li>
        <li><a href="#">Services</a></li>
        <li><a href="#">Portfolio</a></li>
        <li><a href="#">Contact</a></li>
      </ul>
    </div>
    <p class="copyright">
      &copy; <span id="year"></span> Portal de Oportunidades | All Rights Reserved
    </p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/JS/ano.js"></script>
  <script src="/JS/toast.js" defer></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const shouldShow = <%= locals.showWelcomeToast === true %>;
      
      if (shouldShow) {
        // Tenta pegar o nome do currículo primeiro, se não tiver, pega do usuário
        const nomeParaMostrar = "<%= locals.curriculo?.nome || locals.user?.nome || 'Usuário' %>";
        
        showToast(
          `Bem-vindo(a), ${nomeParaMostrar.split(' ')[0]}!`, 
          "Login realizado com sucesso.", 
          "success"
        );
      }
    });
  </script>
</body>

</html>